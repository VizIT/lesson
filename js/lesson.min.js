/*
 Copyright 2013 VizIT Solutions

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
*/
function gaussianSurfaceRChangedEventListiner(f,h){this.handleRChanged=function(e){f.setRadius(e.detail.value);h.render()};this.handleHChanged=function(e){f.setHeight(e.detail.value);h.render()}};function lessonContentEventHandler(f,h){var e;this.handleEvent=function(b){var d,a,g,c;b=b.detail;a=document.getElementsByClassName(e);var p=0;for(g=a.length;p<g;++p)d=a[p],b.source!=d.id&&(c=b.value,d.innerHTML=10>c?"&nbsp;"+c.toFixed(2):c.toFixed(2))};e=h;document.addEventListener(f,this.handleEvent.bind(this),!1)}
function MappingContentEventHandler(f,h,e){var b,d;this.handleEvent=function(a){var g,c,e,m;a=a.detail;c=document.getElementsByClassName(b);var f=0;for(e=c.length;f<e;++f)g=c[f],a.source!=g.id&&(m=d(a.value),g.innerHTML=10>m?"&nbsp;"+m.toFixed(2):m.toFixed(2))};b=e;d=h;document.addEventListener(f,this.handleEvent.bind(this),!1)};function LessonContentIDEventSource(f,h){var e,b;this.handleEvent=function(g){var c,a;g.preventDefault();if(c=this.id)a=c.split("="),1<a.length&&(g=document.createEvent(e),g.initCustomEvent(a[0]+"Changed",!0,!0,{value:parseInt(a[1],10),source:c}),this.dispatchEvent(g))};e="CustomEvent";b=document.getElementsByClassName(h);for(var d=0,a=b.length;d<a;d++)b[d].addEventListener(f,this.handleEvent,!1)};function lessonControlEventHandler(f,h){var e,b,d,a;e=[];b=!1;a=f.getID();d=h.createSVGPoint();this.toSVGCoordinates=function(a,c){d.x=c.clientX;d.y=c.clientY;return d.matrixTransform(a.getScreenCTM().inverse())};this.findTouchByIdentifier=function(a){var c,b;for(c=0;c<e.length;c++)if(b=e[c].identifier,b==a)return c;return-1};this.handleTouchStart=function(a){var c,b,d;d=a.targetTouches;0==e.length&&1==d.length&&f.setScreenX(this.toSVGCoordinates(h,d[0]).x);for(c=0;c<d.length;c++)b=d[c],-1==this.findTouchByIdentifier(b.identifier)&&
e.push(b);if(a.preventDefault)a.preventDefault();else return!1};this.handleTouchEnd=function(a){var c,b,d;d=a.changedTouches;for(c=0;c<d.length;c++)b=this.findTouchByIdentifier(d[c].identifier),-1!=b&&(e.splice(b,1),a.preventDefault())};this.handleOneActiveMove=function(a){var c;c=a.changedTouches[0];null!=e[0]?e.splice(0,1,c):e.push(c);f.setScreenX(this.toSVGCoordinates(h,c).x);if(a.preventDefault)a.preventDefault();else return!1};this.handleTwoActiveMove=function(a){var c,b,d,n,k,l,h;n=e[0];l=e[1];
c=l.pageX-n.pageX;b=l.pageY-n.pageY;d=Math.sqrt(c*c+b*b);h=a.changedTouches;for(c=0;c<h.length;c++)k=h[c],b=k.identifier,n.identifier==b?(n=k,e.splice(0,1,k)):l.identifier==b&&(l=k,e.splice(1,1,k));c=l.pageX-n.pageX;b=l.pageY-n.pageY;n=Math.sqrt(c*c+b*b);f.zoomBy(n/d);if(a.preventDefault)a.preventDefault();else return!1};this.handleTouchMove=function(a){return 1==e.length?this.handleOneActiveMove(a):2==e.length?this.handleTwoActiveMove(a):!0};this.handleMouseDown=function(a){b=!0;this.handleMouseMove(a)};
this.handleMouseUp=function(a){b=!1};this.handleMouseMove=function(a){b&&f.setScreenX(this.toSVGCoordinates(h,a).x)};this.handleMouseWheel=function(a){var c;a=window.event||a;c=a.deltaY?-a.deltaY:a.wheelDeltaY;f.zoomBy(0<c?2:0.5);if(a.preventDefault)a.preventDefault();else return!1};this.handleXChanged=function(b){b=b.detail;b.source!=a&&f.setX(b.value)}};function ModelImageEventHandler(f,h,e){var b,d,a;this.handleEvent=function(c){var e;e=c.detail.value;c=0;for(nvalues=a.length;c<nvalues&&!(a[c]>e);++c);b.src=d[c]};b=f;d=[];a=[];f=0;for(var g=e.length;f<g;f++)0==f%2?d.push(e[f]):a.push(e[f]);document.addEventListener(h+"Changed",this.handleEvent.bind(this),!1)};function RadialDependancyAdaptor(f,h,e,b,d,a){var g,c,p,m,n,k,l,q;this.f=function(a){var b;0==a&&(a=1E-10);b=a*m;a=g.getField(k+b*p,l+b*c,q+a*n);return Math.sqrt(a[0]*a[0]+a[1]*a[1]+a[2]*a[2])};g=f;k=h;l=e;q=b;c=Math.sin(d);p=Math.cos(d);m=Math.sin(a);n=Math.cos(a)};function DotRAdapter(f,h,e,b,d,a){var g,c,p,m,n,k,l,q,r,t,u;this.f=function(a){var b;0==a&&(a=1E-10);b=a*m;a=g.getField(r+b*p,t+b*c,u+a*n);return a[0]*k+a[1]*l+a[2]*q};g=f;r=h;t=e;u=b;c=Math.sin(d);p=Math.cos(d);m=Math.sin(a);n=Math.cos(a);k=p*m;l=c*m;q=n};function SurfaceExtensionEventListiner(f,h){var e,b,d,a,g,c,p,m;this.handleHChanged=function(b){var e,f;f=m.getOrigin();e=m.getHeight();b=(b.detail.value-(f[0]+e*a*g/2))/(a*g);f[0]+=b*a*g/2;f[1]+=b*d*g/2;f[2]+=b*c/2;m.setHeight(e+b);m.setOrigin(f);p.render()};p=h;m=f;e=m.getPhi();b=m.getTheta();d=Math.sin(e);a=Math.cos(e);g=Math.sin(b);c=Math.cos(b)};function ModelExpressionEventHandler(f,h){var e,b,d,a,g;this.handleEvent=function(c){var d,f;f=c.detail.value;c=0;for(d=a.length;c<d&&!(a[c]>f);++c);MathJax.Hub.Queue(["Text",e,b[c]])};MathJax.Hub.queue.Push(function(){e=MathJax.Hub.getAllJax(f)[0]});e=f;b=[];d=Array.prototype.slice.call(arguments,2);a=[];g=h;for(var c=0,p=d.length;c<p;c++)0==c%2?b.push(d[c]):a.push(d[c]);document.addEventListener(g+"Changed",this.handleEvent.bind(this),!1)};function XvsYView(f,h,e,b,d,a,g,c){var p,m,n,k,l,q,r,t,u,z,v,w,s,x,y,A;p=0.1;q=e;r=b;z=1E3/(r-q);w=a;s=g;A=1E3/(s-w);this.getID=function(){return c.id};this.mapXToScreen=function(a){return(a-q)*z};this.mapScreenToX=function(a){return a/z+q};this.mapRawToGroupX=function(a){return a-50};this.mapYToScreen=function(a){a>s?a=s+10:a<w&&(a=w-10);return 1E3-(a-w)*A};this.createPointer=function(a,b){var c=document.createElementNS("http://www.w3.org/2000/svg","use");c.setAttributeNS("http://www.w3.org/1999/xlink",
"href","#pointer");c.setAttributeNS(null,"x",a);c.setAttributeNS(null,"y",b);return c};this.dispatchXChangedEvent=function(){var a;a=document.createEvent("CustomEvent");a.initCustomEvent(h+"Changed",!0,!0,{value:l,source:c.id});c.dispatchEvent(a)};this.setX=function(a){this.x=a;a>=q&&a<=r&&(v=f.f(a),n.x.baseVal.value=this.mapXToScreen(a),n.y.baseVal.value=this.mapYToScreen(v))};this.setScreenX=function(a){a=this.mapRawToGroupX(a);l=this.mapScreenToX(a);l>q&&l<r&&(v=f.f(l),v=this.mapYToScreen(v),n.x.baseVal.value=
a,n.y.baseVal.value=v,this.dispatchXChangedEvent())};this.computePoints=function(){var a,b;k="";for(a=q;a<r;a+=p)b=f.f(a),k+=this.mapXToScreen(a),k+=",",k+=this.mapYToScreen(b),k+=" ";return k=k.substring(0,k.length-1)};this.zoomBy=function(a){var b;q*=a;r*=a;w*=a;s*=a;u.textContent=r.toFixed(2);b=(q+r)/2;t.textContent=b.toFixed(2);y.textContent=s.toFixed(2);b=(w+s)/2;x.textContent=b.toFixed(2);z=1E3/(r-q);A=1E3/(s-w);p*=a;k=this.computePoints();m.setAttributeNS(null,"points",k);l=Math.min(r,Math.max(q,
l));this.setX(l);this.dispatchXChangedEvent()};e=document.createElementNS("http://www.w3.org/2000/svg","g");e.setAttributeNS(null,"transform","translate(50,20)");b=document.createElementNS("http://www.w3.org/2000/svg","defs");a=document.createElementNS("http://www.w3.org/2000/svg","clipPath");a.setAttributeNS(null,"id","plotClip");g=document.createElementNS("http://www.w3.org/2000/svg","rect");g.setAttributeNS(null,"x",0);g.setAttributeNS(null,"y",0);g.setAttributeNS(null,"height",1E3);g.setAttributeNS(null,
"width",1E3);a.appendChild(g);b.appendChild(a);g=document.createElementNS("http://www.w3.org/2000/svg","g");g.setAttributeNS(null,"id","pointer");a=document.createElementNS("http://www.w3.org/2000/svg","circle");a.setAttributeNS(null,"cx",0);a.setAttributeNS(null,"cy",0);a.setAttributeNS(null,"r",12);a.setAttributeNS(null,"class","rPointer");g.appendChild(a);a=document.createElementNS("http://www.w3.org/2000/svg","circle");a.setAttributeNS(null,"cx",0);a.setAttributeNS(null,"cy",0);a.setAttributeNS(null,
"r",5);a.setAttributeNS(null,"class","rPointer");g.appendChild(a);b.appendChild(g);c.appendChild(b);b=document.createElementNS("http://www.w3.org/2000/svg","g");b.setAttributeNS(null,"stroke-width",5);b.setAttributeNS(null,"stroke","black");a=document.createElementNS("http://www.w3.org/2000/svg","path");a.setAttributeNS(null,"d","M 0 1000 L 1000 1000 Z");g=document.createElementNS("http://www.w3.org/2000/svg","path");g.setAttributeNS(null,"d","M 0 0 L 0 1000 Z");b.appendChild(g);b.appendChild(a);
e.appendChild(b);b=document.createElementNS("http://www.w3.org/2000/svg","g");b.setAttributeNS(null,"class","markers");a=document.createElementNS("http://www.w3.org/2000/svg","path");a.setAttributeNS(null,"d","M 0 0 L 1000 0 Z");b.appendChild(a);a=document.createElementNS("http://www.w3.org/2000/svg","path");a.setAttributeNS(null,"d","M 0 500 L 1000 500 Z");b.appendChild(a);a=document.createElementNS("http://www.w3.org/2000/svg","path");a.setAttributeNS(null,"d","M 1000 0 L 1000 1000 Z");b.appendChild(a);
a=document.createElementNS("http://www.w3.org/2000/svg","path");a.setAttributeNS(null,"d","M 500 0 L 500 1000 Z");b.appendChild(a);y=document.createElementNS("http://www.w3.org/2000/svg","text");y.setAttributeNS(null,"x","-10");y.setAttributeNS(null,"y","10");y.setAttributeNS(null,"class","axisLabel");y.appendChild(document.createTextNode(s));b.appendChild(y);x=document.createElementNS("http://www.w3.org/2000/svg","text");x.setAttributeNS(null,"x","-10");x.setAttributeNS(null,"y","510");x.setAttributeNS(null,
"class","axisLabel");x.appendChild(document.createTextNode((w+s)/2));b.appendChild(x);t=document.createElementNS("http://www.w3.org/2000/svg","text");t.setAttributeNS(null,"x","510");t.setAttributeNS(null,"y","1030");t.setAttributeNS(null,"class","axisLabel");t.appendChild(document.createTextNode((q+r)/2));b.appendChild(t);u=document.createElementNS("http://www.w3.org/2000/svg","text");u.setAttributeNS(null,"x","1010");u.setAttributeNS(null,"y","1030");u.setAttributeNS(null,"class","axisLabel");u.appendChild(document.createTextNode(r));
b.appendChild(u);a=document.createElementNS("http://www.w3.org/2000/svg","text");a.setAttributeNS(null,"x","-50");a.setAttributeNS(null,"y","510");a.setAttributeNS(null,"transform","rotate(-90 -50,510)");a.setAttributeNS(null,"class","axisLabel");a.appendChild(document.createTextNode(d));b.appendChild(a);a=document.createElementNS("http://www.w3.org/2000/svg","text");a.setAttributeNS(null,"x","510");a.setAttributeNS(null,"y","1055");a.setAttributeNS(null,"class","axisLabel");a.appendChild(document.createTextNode(h));
b.appendChild(a);k=this.computePoints();m=document.createElementNS("http://www.w3.org/2000/svg","polyline");m.setAttributeNS(null,"class","curve");m.setAttributeNS(null,"points",k);l=15;v=f.f(l);l=this.mapXToScreen(l);v=this.mapYToScreen(v);n=this.createPointer(l,v);e.appendChild(b);e.appendChild(m);e.appendChild(n);c.appendChild(e);d=new lessonControlEventHandler(this,c);c.addEventListener("mousewheel",d.handleMouseWheel.bind(d),!1);c.addEventListener("wheel",d.handleMouseWheel.bind(d),!1);c.addEventListener("mousedown",
d.handleMouseDown.bind(d),!1);document.addEventListener("mouseup",d.handleMouseUp.bind(d),!1);document.addEventListener("mousemove",d.handleMouseMove.bind(d),!1);c.addEventListener("touchstart",d.handleTouchStart.bind(d),!1);c.addEventListener("touchmove",d.handleTouchMove.bind(d),!1);document.addEventListener("touchend",d.handleTouchEnd.bind(d),!1);document.addEventListener(h+"Changed",d.handleXChanged.bind(d),!1)};
